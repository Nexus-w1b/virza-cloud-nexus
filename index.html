<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS AI - V12 PLATINUM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #020617; color: #e2e8f0; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(99, 102, 241, 0.1); }
        .key-dot { width: 10px; height: 10px; border-radius: 2px; transition: all 0.3s ease; }
        .active { background: #6366f1; box-shadow: 0 0 15px #6366f1; transform: scale(1.2); }
        .exhausted { background: #ef4444; box-shadow: 0 0 5px #ef4444; opacity: 0.5; }
        .standby { background: #1e293b; }
        .portal-btn { transition: all 0.2s; border-left: 3px solid transparent; }
        .portal-btn.active { background: rgba(99, 102, 241, 0.1); border-left-color: #6366f1; color: #818cf8; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
    </style>
</head>
<body class="h-screen flex overflow-hidden">

    <aside class="w-64 glass border-r border-slate-800 flex flex-col hidden md:flex">
        <div class="p-6">
            <h2 class="text-xl font-black tracking-tighter text-indigo-500">NEXUS <span class="text-white">V12</span></h2>
            <p class="text-[9px] text-slate-500 tracking-[0.3em] uppercase">Multi-Engine System</p>
        </div>
        
        <nav class="flex-1 px-4 space-y-1 overflow-y-auto" id="portalContainer">
            <p class="text-[10px] font-bold text-slate-600 px-2 py-2 uppercase">Core Portals</p>
            </nav>

        <div class="p-4 border-t border-slate-800 bg-black/20">
            <div class="flex justify-between items-center mb-3">
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Demons 20 Pool</span>
                <span id="activeCount" class="text-[10px] bg-indigo-500/20 text-indigo-400 px-2 py-0.5 rounded">20/20</span>
            </div>
            <div id="keyGrid" class="grid grid-cols-5 gap-2">
                </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative">
        <header class="h-16 glass flex items-center justify-between px-6 z-10">
            <div class="flex items-center gap-4">
                <div id="currentPortalIcon" class="w-8 h-8 rounded-lg bg-indigo-500/10 flex items-center justify-center text-indigo-400">
                    <i class="fa-solid fa-ghost"></i>
                </div>
                <div>
                    <h3 id="portalTitle" class="text-sm font-bold">General Nexus</h3>
                    <p class="text-[10px] text-slate-500" id="modelStatus">Engine: Initializing...</p>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                <select id="modelSelect" class="bg-slate-900 border border-slate-700 text-[10px] rounded-md px-2 py-1 outline-none focus:border-indigo-500">
                    <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                    <option value="gemini-1.5-flash-8b">Gemini 1.5 Flash-8B</option>
                    <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                </select>
            </div>
        </header>

        <div id="chatBox" class="flex-1 overflow-y-auto p-6 space-y-6 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
            <div class="flex justify-start">
                <div class="max-w-[80%] glass p-4 rounded-2xl rounded-tl-none shadow-2xl">
                    <p class="text-xs leading-relaxed">System ready. **Demons 20** active. Silahkan pilih portal atau langsung kirim perintah, Bang.</p>
                </div>
            </div>
        </div>

        <div class="p-4 bg-slate-950/50 backdrop-blur-xl">
            <div class="max-w-4xl mx-auto flex items-end gap-3 glass p-2 rounded-2xl border-slate-700/50">
                <textarea id="mainInput" placeholder="Enter command..." rows="1" class="flex-1 bg-transparent border-none focus:ring-0 text-sm p-2 resize-none max-h-40 outline-none"></textarea>
                <button onclick="sendMessage()" id="sendBtn" class="bg-indigo-600 hover:bg-indigo-500 w-10 h-10 rounded-xl flex items-center justify-center transition-all shadow-lg shadow-indigo-500/20">
                    <i class="fa-solid fa-paper-plane text-xs"></i>
                </button>
            </div>
        </div>
    </main>

    <script>
        // --- CONFIGURATION ---
        const API_KEYS = [
            "AIzaSyCCUqg6OZdWaUasvKY7QV0fWqwUt4CsmpQ", "AIzaSyAsKUTqGlMvqtN-E3e5-4P5oz7sij1QL_E",
            "AIzaSyDCxkjv1wRdCJHQSJJX-mMdDW1-LZp4jyo", "AIzaSyB13AmGhznITsd_W7Rz54LfQ7qWJfV7IEc",
            "AIzaSyC52CUuke2D6K91snVx8iEH_z8pT_Ixnec", "AIzaSyBjobCOS-zciLKG-OMdgdu9sNpa8OFSx7I",
            "AIzaSyDLL4hK9sL3nDXdVDloZAy4trcTDJlPS3w", "AIzaSyDA93sUm7bqXP1CKz0C7l2JpKYVQd8bkRw",
            "AIzaSyA26tL2c5UOf4Z7dqWSWFw56-SVpG8luzI", "AIzaSyAEX43Ur6C8D47iZlHm2OWvgeAs1FZGg68",
            "AIzaSyCeDZF95_0qDbwSVvFb_jHCUZGesC_1sPw", "AIzaSyD_d87NBjNwHbwwfj9RwepVw7nDkSqzR-8",
            "AIzaSyA9GdGZJ1Y4xxNzABt-4XEpQ-liLlxPtRM", "AIzaSyCjewApIzC8JmRJ0ApX0A_nVlmGlb2GH_A",
            "AIzaSyC2wry9c0xn2p7v9aJK4ksT4XOYsAza5Bw", "AIzaSyDXLt2LlOiJ75N35CGTGgGGHwRdJ2G2o34",
            "AIzaSyBXgfh6zT-r8o0tGivo8NHmdynJXSHd464", "AIzaSyAKeOQQUzD90kHbgkYiQ5O5C4kZWKqf7ek",
            "AIzaSyAKeOQQUzD90kHbgkYiQ5O5C4kZWKqf7ek", "AIzaSyBXgfh6zT-r8o0tGivo8NHmdynJXSHd464"
        ];

        const PORTALS = [
            { name: "General Nexus", icon: "fa-ghost", desc: "AI Assistant Umum" },
            { name: "Code Demon", icon: "fa-code", desc: "Spesialis Programming" },
            { name: "Creative Engine", icon: "fa-paint-brush", desc: "Generate Ide & Narasi" },
            { name: "Cyber Security", icon: "fa-shield-halved", desc: "Analisis Data & Keamanan" }
        ];

        let currentKeyIndex = 0;
        let exhaustedKeys = new Set();
        const FALLBACK_MODELS = ["gemini-1.5-flash", "gemini-1.5-flash-8b", "gemini-1.5-pro"];

        // --- INITIALIZE UI ---
        function initPortal() {
            const container = document.getElementById('portalContainer');
            container.innerHTML += PORTALS.map(p => `
                <button onclick="switchPortal('${p.name}', '${p.icon}')" class="portal-btn w-full flex items-center gap-3 px-3 py-3 rounded-lg text-xs text-slate-400 hover:text-white">
                    <i class="fa-solid ${p.icon} w-4"></i>
                    <span>${p.name}</span>
                </button>
            `).join('');
            updateDemonsUI();
        }

        function updateDemonsUI() {
            const grid = document.getElementById('keyGrid');
            grid.innerHTML = API_KEYS.map((_, i) => {
                let status = exhaustedKeys.has(i) ? 'exhausted' : (i === currentKeyIndex ? 'active' : 'standby');
                return `<div class="key-dot ${status}" title="Key #${i+1}"></div>`;
            }).join('');
            document.getElementById('activeCount').textContent = `${API_KEYS.length - exhaustedKeys.size}/${API_KEYS.length}`;
            document.getElementById('modelStatus').textContent = `Engine: Active on Key #${currentKeyIndex + 1}`;
        }

        function switchPortal(name, icon) {
            document.getElementById('portalTitle').innerText = name;
            document.getElementById('currentPortalIcon').innerHTML = `<i class="fa-solid ${icon}"></i>`;
            document.querySelectorAll('.portal-btn').forEach(btn => {
                btn.classList.toggle('active', btn.innerText.includes(name));
            });
        }

        // --- CORE LOGIC (SEND MESSAGE) ---
        async function sendMessage() {
            const input = document.getElementById('mainInput');
            const chat = document.getElementById('chatBox');
            const prompt = input.value.trim();
            if(!prompt) return;

            // Cari Key yang Aktif
            let key = null;
            let attempts = 0;
            while (attempts < API_KEYS.length) {
                if (!exhaustedKeys.has(currentKeyIndex)) {
                    key = API_KEYS[currentKeyIndex];
                    break;
                }
                currentKeyIndex = (currentKeyIndex + 1) % API_KEYS.length;
                attempts++;
            }

            if (!key) return alert("All Demons Exhausted! Tunggu reset.");

            // User UI
            chat.innerHTML += `<div class="flex justify-end"><div class="max-w-[80%] bg-indigo-600 p-3 rounded-2xl rounded-tr-none text-xs text-white shadow-xl">${prompt}</div></div>`;
            input.value = '';
            
            const typingId = 'typing-' + Date.now();
            chat.innerHTML += `<div id="${typingId}" class="flex justify-start"><div class="glass p-3 rounded-xl"><div class="flex gap-1"><div class="w-1 h-1 bg-indigo-400 rounded-full animate-bounce"></div><div class="w-1 h-1 bg-indigo-400 rounded-full animate-bounce delay-75"></div><div class="w-1 h-1 bg-indigo-400 rounded-full animate-bounce delay-150"></div></div></div></div>`;
            chat.scrollTop = chat.scrollHeight;

            // LOGIKA FALLBACK MODEL
            const userModel = document.getElementById('modelSelect').value;
            const modelRotation = [userModel, ...FALLBACK_MODELS.filter(m => m !== userModel)];
            
            let finalData = null;
            let success = false;

            for (let modelName of modelRotation) {
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${key}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const data = await res.json();

                    if (data.error) {
                        if (data.error.status === 'RESOURCE_EXHAUSTED') continue; // Coba model cadangan
                        throw new Error(data.error.message);
                    }

                    finalData = data.candidates[0].content.parts[0].text;
                    success = true;
                    break;
                } catch (e) { console.error(e); }
            }

            document.getElementById(typingId).remove();

            if (success) {
                chat.innerHTML += `<div class="flex justify-start"><div class="max-w-[85%] glass p-4 rounded-2xl rounded-tl-none text-xs leading-relaxed border-l-2 border-indigo-500">${finalData.replace(/\n/g, '<br>')}</div></div>`;
            } else {
                exhaustedKeys.add(currentKeyIndex);
                updateDemonsUI();
                input.value = prompt; // Restore text
                sendMessage(); // Recursive Retry ke Key berikutnya
            }
            chat.scrollTop = chat.scrollHeight;
        }

        // Init on Load
        initPortal();
        switchPortal('General Nexus', 'fa-ghost');
    </script>
</body>
</html>
